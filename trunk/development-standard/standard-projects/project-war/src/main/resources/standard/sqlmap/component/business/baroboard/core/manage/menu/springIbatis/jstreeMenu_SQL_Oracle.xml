<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="coreMenu">
	<typeAlias alias="coreMenuVO"
		type="standard.mvc.component.business.baroboard.core.manage.menu.vo.CoreMenuVO" />
	<sql id="getMetaField">
		/* getChildNode */
		SELECT A.c_id
		, A.c_parentid
		, A.c_position
		, A.c_left
		, A.c_right
		, A.c_level
		, A.c_title
		, A.c_type
		/* user filed add
		point*/
	</sql>
	<sql id="getInlineChildCount">
		, ( SELECT CASE
		WHEN COUNT(*) &gt; 0 THEN 'InChild'
		ELSE
		'NoChild'
		END AS YesNo
		/* inline table from filed add point*/
	</sql>
	<sql id="getInlineChildCountAfterFrom">
		WHERE B.C_PARENTID = A.C_ID
		) AS childcount
		/* table from
		filed add point*/
	</sql>
	<sql id="getAfterFrom">
		WHERE A.C_PARENTID = #c_id#
		ORDER BY A.C_POSITION ASC
	</sql>

	<select id="getChildNode" parameterClass="coreMenuVO" resultClass="coreMenuVO">
		<dynamic>
			<include refid="getMetaField" />
			/* user filed */
			, C_MENU_ID as menuId
			, C_PAGE_ID as pageId
			, C_AUTH_ID as authId
			, C_IMAGE_DEAULT as imageDefault
			, C_IMAGE_HOVER as imageHover
			, C_IMAGE_SELECTED as imageSelected
			, C_HOME_FL as homeFl
			<include refid="getInlineChildCount" />
			/* inline table from filed*/
			FROM T_CORE_MENU B
			<include refid="getInlineChildCountAfterFrom" />
			/* table from filed*/
			FROM T_CORE_MENU A
			<include refid="getAfterFrom" />
		</dynamic>
	</select>

	<select id="getNode" parameterClass="coreMenuVO" resultClass="coreMenuVO">
		/*
		getNode */
		SELECT C_ID
		, C_PARENTID
		, C_POSITION
		, C_LEFT
		, C_RIGHT
		, C_LEVEL
		, C_TITLE
		, C_TYPE
		, C_MENU_ID as menuId
		, C_PAGE_ID as pageId
		, C_AUTH_ID as authId
		, C_IMAGE_DEAULT as imageDefault
		, C_IMAGE_HOVER as imageHover
		, C_IMAGE_SELECTED as imageSelected
		, C_HOME_FL as homeFl
		FROM T_CORE_MENU
		WHERE C_ID = #c_id#
	</select>
	
	<select id="getNodeByRef" parameterClass="coreMenuVO"
		resultClass="coreMenuVO">
		/* getNodeByRef */
		SELECT C_ID
		, C_PARENTID
		, C_POSITION
		,
		C_LEFT
		, C_RIGHT
		, C_LEVEL
		, C_TITLE
		, C_TYPE
		, C_MENU_ID as menuId
		, C_PAGE_ID as pageId
		, C_AUTH_ID as authId
		, C_IMAGE_DEAULT as imageDefault
		, C_IMAGE_HOVER as imageHover
		, C_IMAGE_SELECTED as imageSelected
		, C_HOME_FL as homeFl		
		FROM
		T_CORE_MENU
		WHERE C_ID = #ref#
	</select>	

	<update id="alterNode" parameterClass="coreMenuVO">
		/* alterNode */
		UPDATE
			T_CORE_MENU
		SET 
			C_TITLE = #c_title#
			, C_TYPE = #c_type#
			, C_MENU_ID = #menuId#
			, C_PAGE_ID = #pageId#
			, C_AUTH_ID = #authId#
			, C_IMAGE_DEAULT = #imageDefault#
			, C_IMAGE_HOVER = #imageHover#
			, C_IMAGE_SELECTED = #imageSelected#
			, C_HOME_FL = #homeFl#
		WHERE C_ID = #c_id#
	</update>
	
	<update id="stretchPositionForMyself" parameterClass="ComprehensiveTree">
		/* stretchPositionForMyselfFromJstree */
		UPDATE
		T_CORE_MENU
		SET C_POSITION = C_POSITION + 1
		WHERE
		C_PARENTID = #ref# AND C_POSITION &gt;= #c_position#
		<isEqual property="copy" compareValue="0">
			AND C_ID NOT IN
			<isEmpty property="c_idsByChildNodeFromNodeById">
				(-1)
			</isEmpty>
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate property="c_idsByChildNodeFromNodeById" open="("
					close=")" conjunction=",">
					#c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>


	<update id="stretchLeftForMyselfFromJstree" parameterClass="ComprehensiveTree">
		/* stretchLeftForMyselfFromJstree */
		UPDATE T_CORE_MENU
		SET C_LEFT = C_LEFT + #spaceOfTargetNode#
		WHERE C_LEFT &gt;=
		#rightPositionFromNodeByRef#
		<isEqual property="copy" compareValue="0">
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate prepend="AND C_ID NOT IN" property="c_idsByChildNodeFromNodeById"
					open="(" close=")" conjunction=",">
					#c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>


	<update id="stretchRightForMyselfFromJstree" parameterClass="ComprehensiveTree">
		/* stretchRightForMyselfFromJstree */
		UPDATE T_CORE_MENU
		SET C_RIGHT = C_RIGHT + #spaceOfTargetNode#
		WHERE C_RIGHT &gt;=
		#rightPositionFromNodeByRef#
		<isEqual property="copy" compareValue="0">
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate prepend="AND C_ID NOT IN" property="c_idsByChildNodeFromNodeById"
					open="(" close=")" conjunction=",">
					#c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>	
	
	<insert id="addMyselfFromJstree" parameterClass="coreMenuVO">
		/* addMyselfFromJstree */
		INSERT INTO T_CORE_MENU (
		C_ID, C_PARENTID, C_POSITION,
		C_LEFT, C_RIGHT, C_LEVEL )
		VALUES (
		S_CORE_MENU.NEXTVAL, #c_parentid#, #c_position#,
		#c_left#, #c_right#, #c_level# )
		<selectKey resultClass="java.lang.Integer">
			/* addMyselfFromJstree SEQ */
			SELECT
			S_CORE_MENU.CURRVAL AS SEQ
			FROM DUAL
		</selectKey>
	</insert>


	<update id="alterNodeType" parameterClass="coreMenuVO">
		/* alterNodeType */
		UPDATE T_CORE_MENU
		SET C_TYPE = #c_type#
		WHERE C_ID =
		#c_id#
	</update>	

</sqlMap>