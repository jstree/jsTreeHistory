<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="joinField">
	<typeAlias alias="JoinField" type="standard.mvc.component.business.baroboard.user.manage.basic.setting.joinfield.vo.JoinField" />

	<select id="getChildNode" parameterClass="JoinField" resultClass="JoinField">
		/* getChildNode */
		SELECT A.C_ID
		     , A.C_PARENTID
		     , A.C_POSITION
		     , A.C_LEFT
		     , A.C_RIGHT
		     , A.C_LEVEL
		     , A.C_TITLE
		     , A.C_TYPE
		     , A.C_USE_FL AS useFl
		     , A.C_INFO_OPEN_FL AS infoOpenFl
		     , A.C_ESSE_INPUT_FL AS esseInputFl
		     , ( SELECT CASE
		                    WHEN COUNT(*) &gt; 0 THEN 'InChild'
           		 			ELSE 'NoChild'
           		 		END AS YesNo
         		   FROM T_USER_JOIN_FIELD B
       			  WHERE B.C_PARENTID = A.C_ID
     		   ) AS childcount
		  FROM T_USER_JOIN_FIELD A
		 WHERE A.C_PARENTID = #c_id#
	  ORDER BY A.C_POSITION ASC
	</select>


	<select id="getChildNodeByLeftRight" parameterClass="JoinField" resultClass="JoinField">
		/* getChildNodeByLeftRight */
		SELECT C_ID
		     , C_PARENTID
		     , C_POSITION
		     , C_LEFT
		     , C_RIGHT
		     , C_LEVEL
		     , C_TITLE
		     , C_TYPE
		     , C_USE_FL AS useFl
             , C_INFO_OPEN_FL AS infoOpenFl
             , C_ESSE_INPUT_FL AS esseInputFl
		  FROM T_USER_JOIN_FIELD 
		 WHERE C_LEFT &gt;= #c_left# 
		   AND C_RIGHT &lt;= #c_right# 
	  ORDER BY C_LEFT ASC
	</select>


	<select id="searchNodeByString" parameterClass="JoinField" resultClass="JoinField">
		/* searchNodeByString */
		SELECT C_LEFT
		     , C_RIGHT
		  FROM T_USER_JOIN_FIELD
		 WHERE C_TITLE LIKE '%'||#searchStr#||'%' 
	</select>


	<select id="searchNodeByPosition" parameterClass="java.util.List" resultClass="String">
		/* searchNodeByPosition */
        SELECT DISTINCT C_ID
          FROM T_USER_JOIN_FIELD
         WHERE 1=1
        <iterate prepend="AND" open="(" close=")" conjunction="OR">
            ( C_LEFT &lt;= #[].c_left# AND C_RIGHT &gt;= #[].c_right# )
        </iterate>
	</select>


	<update id="alterNode" parameterClass="JoinField">
		/* alterNode */
		UPDATE T_USER_JOIN_FIELD 
		   SET C_TYPE = #c_type#
		     , C_TITLE = #c_title#
		     , C_USE_FL = #useFl#
             , C_INFO_OPEN_FL = #infoOpenFl#
             , C_ESSE_INPUT_FL = #esseInputFl#
		 WHERE C_ID = #c_id#
	</update>


	<select id="getNode" parameterClass="JoinField" resultClass="JoinField">
		/* getNode */
        SELECT C_ID
             , C_PARENTID
             , C_POSITION
             , C_LEFT
             , C_RIGHT
             , C_LEVEL
             , C_TITLE
             , C_TYPE
             , C_USE_FL AS useFl
             , C_INFO_OPEN_FL AS infoOpenFl
             , C_ESSE_INPUT_FL AS esseInputFl
          FROM T_USER_JOIN_FIELD 
         WHERE C_ID = #c_id#
    </select>


	<select id="getNodeByRef" parameterClass="JoinField" resultClass="JoinField">
		/* getNodeByRef */
        SELECT C_ID
             , C_PARENTID
             , C_POSITION
             , C_LEFT
             , C_RIGHT
             , C_LEVEL
             , C_TITLE
             , C_TYPE
             , C_USE_FL AS useFl
             , C_INFO_OPEN_FL AS infoOpenFl
             , C_ESSE_INPUT_FL AS esseInputFl
          FROM T_USER_JOIN_FIELD 
         WHERE C_ID = #ref#
    </select>


	<delete id="removeNode" parameterClass="JoinField">
		/* removeNode */
       	DELETE FROM T_USER_JOIN_FIELD 
       	      WHERE C_LEFT  &gt;= #c_left#
       	        AND C_RIGHT &lt;= #c_right#
	</delete>
	
	
	<update id="removedAfterLeftFix" parameterClass="JoinField">
		/* removedAfterLeftFix */
       	UPDATE T_USER_JOIN_FIELD 
  		   SET C_LEFT = C_LEFT - #spaceOfTargetNode# 
   	 	 WHERE C_LEFT &gt; #c_right#
	</update>
	
	
	<update id="removedAfterRightFix" parameterClass="JoinField">
		/* removedAfterRightFix */
		UPDATE T_USER_JOIN_FIELD 
		   SET C_RIGHT = C_RIGHT - #spaceOfTargetNode# 
		 WHERE C_RIGHT &gt; #c_left#
	</update>
	
	
	<update id="removedAfterPositionFix" parameterClass="JoinField">
		/* removedAfterPositionFix */
     	UPDATE T_USER_JOIN_FIELD 
     	   SET C_POSITION = C_POSITION - 1 
     	 WHERE C_PARENTID = #c_parentid# 
     	   AND C_POSITION &gt; #c_position#
	</update>


	<select id="analyzeRootNode" resultClass="JoinField">
		/* analyzeRootNode */
	    SELECT C_LEFT 
		  FROM T_USER_JOIN_FIELD 
		 WHERE C_PARENTID = 0
    </select>


	<update id="cutMyselfPositionFix" parameterClass="JoinField">
		/* cutMyselfPositionFix */
       	UPDATE T_USER_JOIN_FIELD 
       	   SET C_POSITION = C_POSITION - 1 
       	 WHERE C_PARENTID = #c_parentid# 
           AND C_POSITION &gt; #c_position#
    </update>


	<update id="cutMyselfLeftFix" parameterClass="JoinField">
		/* cutMyselfLeftFix */
       	UPDATE T_USER_JOIN_FIELD 
       	   SET C_LEFT = C_LEFT - #spaceOfTargetNode# 
         WHERE C_LEFT &gt; #c_right#
    </update>
    
    
	<update id="cutMyselfRightFix" parameterClass="JoinField">
		/* cutMyselfRightFix */
       	UPDATE T_USER_JOIN_FIELD 
       	   SET C_RIGHT = C_RIGHT - #spaceOfTargetNode# 
       	 WHERE C_RIGHT &gt; #c_left#
		<iterate prepend="AND C_ID NOT IN" property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
		       #c_idsByChildNodeFromNodeById[]#
		</iterate>
	</update>


	<update id="stretchPositionForMyself" parameterClass="JoinField">
		/* stretchPositionForMyselfFromJstree */
        UPDATE T_USER_JOIN_FIELD
           SET C_POSITION = C_POSITION + 1
         WHERE C_PARENTID = #ref# AND C_POSITION &gt;= #c_position#
		<isEqual property="copy" compareValue="0">
           AND C_ID NOT IN
			<isEmpty property="c_idsByChildNodeFromNodeById">
						   (-1)
			</isEmpty>
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
		                   #c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>


	<update id="stretchLeftForMyselfFromJstree" parameterClass="JoinField">
		/* stretchLeftForMyselfFromJstree */
       	UPDATE T_USER_JOIN_FIELD 
       	   SET C_LEFT = C_LEFT + #spaceOfTargetNode# 
       	 WHERE C_LEFT &gt;= #rightPositionFromNodeByRef#
		<isEqual property="copy" compareValue="0">
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate prepend="AND C_ID NOT IN" property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
					#c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>


	<update id="stretchRightForMyselfFromJstree" parameterClass="JoinField">
		/* stretchRightForMyselfFromJstree */
        UPDATE T_USER_JOIN_FIELD 
           SET C_RIGHT = C_RIGHT + #spaceOfTargetNode# 
         WHERE C_RIGHT &gt;= #rightPositionFromNodeByRef#
		<isEqual property="copy" compareValue="0">
			<isNotEmpty property="c_idsByChildNodeFromNodeById">
				<iterate prepend="AND C_ID NOT IN" property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
			   #c_idsByChildNodeFromNodeById[]#
				</iterate>
			</isNotEmpty>
		</isEqual>
	</update>


	<insert id="pasteMyselfFromJstree" parameterClass="JoinField">
		/* pasteMyselfFromJstree */
        INSERT INTO T_USER_JOIN_FIELD ( C_ID, C_PARENTID, C_POSITION, C_LEFT, C_RIGHT, C_LEVEL, C_TITLE, C_TYPE, C_USE_FL, C_INFO_OPEN_FL, C_ESSE_INPUT_FL ) 
    	SELECT S_USER_JOIN_FIELD.NEXTVAL AS C_ID
    	     , A.*
       	  FROM (
		        SELECT #ref#
		             , C_POSITION
		             , C_LEFT  - #idifLeft#  AS C_LEFT
		             , C_RIGHT - #idifRight# AS C_RIGHT
		             , C_LEVEL - #ldif#      AS C_LEVEL
		             , C_TITLE
		             , C_TYPE
		             , C_USE_FL
		             , C_INFO_OPEN_FL
		             , C_ESSE_INPUT_FL
		          FROM T_USER_JOIN_FIELD 
	    <iterate prepend="WHERE C_ID IN" property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
		               #c_idsByChildNodeFromNodeById[]#
		</iterate>
		      ORDER BY C_LEVEL DESC
			   ) A
		<selectKey resultClass="java.lang.Integer">
			/* pasteMyselfFromJstree SEQ */
            SELECT S_USER_JOIN_FIELD.CURRVAL AS SEQ 
              FROM DUAL
        </selectKey>
	</insert>


	<update id="enterMyselfFixPosition" parameterClass="JoinField">
		/* enterMyselfFixPosition */
        UPDATE T_USER_JOIN_FIELD 
           SET C_PARENTID = #ref#
             , C_POSITION = #c_position# 
         WHERE C_ID = #c_id#
    </update>
    
    
	<update id="enterMyselfFixLeftRight" parameterClass="JoinField">
		/* enterMyselfFixLeftRight */
        UPDATE T_USER_JOIN_FIELD 
           SET C_LEFT  = C_LEFT  - (#idif#)
             , C_RIGHT = C_RIGHT - (#idif#)
             , C_LEVEL = C_LEVEL - (#ldif#)
		<iterate prepend="WHERE C_ID IN" property="c_idsByChildNodeFromNodeById" open="(" close=")" conjunction=",">
			   #c_idsByChildNodeFromNodeById[]#
		</iterate>
	</update>


	<insert id="addMyselfFromJstree" parameterClass="JoinField">
		/* addMyselfFromJstree */
        INSERT INTO T_USER_JOIN_FIELD ( C_ID, C_PARENTID, C_POSITION, C_LEFT, C_RIGHT, C_LEVEL, C_TITLE, C_USE_FL, C_INFO_OPEN_FL, C_ESSE_INPUT_FL )
                              VALUES ( S_USER_JOIN_FIELD.NEXTVAL, #c_parentid#, #c_position#, #c_left#, #c_right#, #c_level#, #c_title#, #useFl#, #infoOpenFl#, #esseInputFl# )
        <selectKey resultClass="java.lang.Integer">
        	/* addMyselfFromJstree SEQ */
            SELECT S_USER_JOIN_FIELD.CURRVAL AS SEQ
              FROM DUAL
        </selectKey>
	</insert>


	<update id="alterNodeType" parameterClass="JoinField">
		/* alterNodeType */
		UPDATE T_USER_JOIN_FIELD 
		   SET C_TYPE = #c_type#
		 WHERE C_ID = #c_id#
	</update>


	<update id="fixCopyIF" parameterClass="JoinField">
        /* fixCopyIF */
        UPDATE T_USER_JOIN_FIELD 
           SET C_POSITION = #fixCopyPosition# 
         WHERE C_ID = #fixCopyId#
	</update>


	<update id="fixCopy" parameterClass="JoinField">
		/* fixCopy */
		UPDATE T_USER_JOIN_FIELD 
		   SET C_PARENTID = #fixCopyId# 
		 WHERE C_ID = #c_id#
	</update>
	
	
    <update id="alterEssentialJoinField" parameterClass="JoinField">
        /* alterEssentialJoinField */
        UPDATE T_USER_JOIN_FIELD 
           SET C_INFO_OPEN_FL = #infoOpenFl#
         WHERE C_ID = #c_id#
    </update>
    
    
    <update id="alterOptionalJoinField" parameterClass="JoinField">
        /* alterOptionalJoinField */
        UPDATE T_USER_JOIN_FIELD 
           SET C_USE_FL = #useFl#
             , C_INFO_OPEN_FL = #infoOpenFl#
             , C_ESSE_INPUT_FL = #esseInputFl#
         WHERE C_ID = #c_id#
    </update>
</sqlMap>